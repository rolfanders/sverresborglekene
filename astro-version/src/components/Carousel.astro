---
// Server-side kode
import { Image } from 'astro:assets';

interface Image {
    filename: string;
    url: string;
    description?: string;
}

// Importer JSON-filen direkte
import bilderjson from '../../public/images/slideshow/bilder.json' assert { type: 'json' };
const images = bilderjson.images || [];
---

<!-- HTML markup -->
<div class="carousel">
    {
        images.length > 0 ? (
            images.map((image: Image, index: number) => (
                <img
                    src={image.url}
                    alt={image.description || `Bilde ${index + 1} fra Sverresborglekene`}
                    class={index === 0 ? "active" : ""}
                    loading={index === 0 ? "eager" : "lazy"}
                    width="1200"
                    height="800"
                />
            ))
        ) : (
            <p>Ingen bilder å vise.</p>
        )
    }
</div>

<script>
    // Klient-side kode
    function setupCarousel() {
        const carousel = document.querySelector(".carousel");
        if (!carousel) return;

        const images = carousel.querySelectorAll("img");
        if (images.length <= 1) return;

        let currentIndex = 0;

        setInterval(() => {
            images[currentIndex].classList.remove("active");
            currentIndex = (currentIndex + 1) % images.length;
            images[currentIndex].classList.add("active");
        }, 3000);
    }

    // Kjør setup når DOM er lastet
    document.addEventListener("DOMContentLoaded", setupCarousel);
</script>

<style>
    .carousel {
        width: 100%;
        margin: 0 auto;
        position: relative;
        overflow: hidden;
        border-radius: 8px;
        margin-bottom: 0.5em;
        display: grid; /* Gjør at det aktive bildet setter høyden */
        justify-items: center; /* Sentrerer bilder horisontalt */
    }

    .carousel img {
        width: 100%; /* Tilpasser seg containerens bredde */
        max-width: 100%;
        height: auto;
        opacity: 0; /* Starter usynlig */
        visibility: hidden; /* Skjuler bildet */
        transition:
            opacity 1s ease-in-out,
            visibility 0s linear 1s;
        grid-area: 1 / 1; /* Alle bildene overlapper */
    }

    .carousel img.active {
        opacity: 1;
        visibility: visible;
        transition:
            opacity 1s ease-in-out,
            visibility 0s linear 0s;
    }
</style>
