---
interface Image {
  filename: string;
  url: string;
  description?: string;
}

// Hent bilder fra lokal JSON
async function getImages(): Promise<Image[]> {
  try {
    const response = await fetch('images/slideshow/bilder.json');
    if (!response.ok) throw new Error('Kunne ikke hente bilder');
    const data = await response.json();
    return data.images || [];
  } catch (error) {
    console.error('Feil ved henting av bilder:', error);
    return [];
  }
}

const images = await getImages();
---

<div class="carousel">
  {images.length > 0 ? (
    images.map((image: Image, index: number) => (
      <img 
        src={image.url} 
        alt={image.description || `Bilde ${index + 1} fra Sverresborglekene`} 
        class={index === 0 ? 'active' : ''} 
        loading={index === 0 ? 'eager' : 'lazy'}
      />
    ))
  ) : (
    <p>Ingen bilder å vise.</p>
  )}
</div>

<script>
  function setupCarousel() {
    const carousel = document.querySelector('.carousel');
    if (!carousel) return;

    const images = carousel.querySelectorAll('img');
    if (images.length <= 1) return;

    let currentIndex = 0;
    let isTransitioning = false;

    function showNextImage() {
      if (isTransitioning) return;
      isTransitioning = true;

      images[currentIndex].classList.remove('active');
      currentIndex = (currentIndex + 1) % images.length;
      images[currentIndex].classList.add('active');

      setTimeout(() => {
        isTransitioning = false;
      }, 1000); // Match transition duration
    }

    setInterval(showNextImage, 5000); // Økt intervall til 5 sekunder
  }

  document.addEventListener('DOMContentLoaded', setupCarousel);
</script>

<style>
  .carousel {
    width: 100%;
    margin: 0 auto;
    position: relative;
    overflow: hidden;
    border-radius: 24px;
    margin-bottom: 2em;
    display: grid;
    justify-items: center;
    aspect-ratio: 16 / 9;
  }

  .carousel img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    visibility: hidden;
    transition: opacity 1s ease-in-out, visibility 0s linear 1s;
    grid-area: 1 / 1;
    border-radius: 24px;
  }

  .carousel img.active {
    opacity: 1;
    visibility: visible;
    transition: opacity 1s ease-in-out, visibility 0s linear 0s;
  }
</style>
